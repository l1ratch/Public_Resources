### **Техническое задание (ТЗ) на плагин Minecraft: «Perudo Master»**

**Версия:** 2.1
**Цель:** Создать систему игры в кости на ставки через NPC с поддержкой ставок предметами и деньгами.

---

### **1. Общее описание**

Весь процесс идёт через NPC-Крупье. Игроки создают игру, указывая тип ставки (предмет или деньги), присоединяются к ней. Бросок костей происходит автоматически, результаты отправляются в ЛС. Выигрыш передаётся победителю автоматически.

---

### **2. Типы ставок**

*   **`i:` - Ставка предметом.** Например: `i:diamond` или `i:netherite_ingot`. Из инвентаря игрока будет изъят 1 указанный предмет.
*   **`m:` - Ставка деньгами (требует Vault).** Например: `m:100` или `m:5000`. Указанная сумма будет списана с счёта игрока.

---

### **3. Последовательность работы (Игровой процесс)**

1.  **Создание игры:**
    *   Игрок-создатель кликает ПКМ по NPC -> выбирает `«Создать игру»`.
    *   Получает сообщение: `[Крупье] Введите команду: /bet <ставка> <кубики> <игроки>. Пример: /bet i:diamond 3 4 или /bet m:500 5 2`
    *   Игрок вводит команду. Например: `/bet m:1000 3 4`
    *   NPC объявляет: `[Крупье] Игрок Ivan создал игру! Ставка: 1000$. Для присоединения нажмите на меня.`

2.  **Присоединение к игре:**
    *   Другие игроки кликают ПКМ по NPC -> `«Присоединиться к игре»`.
    *   **Проверка:**
        *   Для `i:` - проверяется, есть ли у игрока в инвентаре нужный предмет.
        *   Для `m:` - проверяется, достаточно ли у игрока денег (через Vault).
    *   При успехе ставка изымается, игрок добавляется в игру.
    *   NPC объявляет: `[Крупье] Игрок Petr присоединился! (2/4)`

3.  **Начало игры, бросок, оповещение:**
    *   Процесс идентичен предыдущему ТЗ. NPC объявляет начало, плагин автоматически бросает кости.
    *   **Результаты в ЛС каждому игроку:**
        *   `[Крупье] Ваш бросок: 4, 2, 6. Сумма: 12.`
        *   `[Крупье] Результаты других: Petr - 9, Sergei - 15.`

4.  **Определение победителя и выдача выигрыша:**
    *   Плагин определяет победителя.
    *   **Расчёт банка:**
        *   Если ставка **предметами**, банк — это все изъятые у игроков предметы.
        *   Если ставка **деньгами**, банк — это общая сумма всех ставок.
    *   **Выдача:**
        *   Для **предметов:** все предметы перемещаются в инвентарь победителя.
        *   Для **денег:** общая сумма банка зачисляется на счёт победителя через Vault.
    *   NPC объявляет: `[Крупье] Победитель - Sergei с суммой 15 очков! Он забирает банк в размере 4000$!`

---

### **4. Команды для игроков**

*   **`/bet <ставка> <dice> <players>`** - Команда для настройки игры.
    *   **`<ставка>`**: Определяет тип и размер ставки.
        *   **`i:<предмет>`** - Ставка предметом. Например: `i:diamond`, `i:gold_ingot`.
        *   **`m:<сумма>`** - Ставка деньгами. Например: `m:100`, `m:5000`.
    *   **`<dice>`**: Количество кубиков (1-5).
    *   **`<players>`**: Общее число игроков (2-6).

---

### **5. Команды для администрирования (`perudoadmin`)**

*   `/perudoadmin reload` – Перезагружает конфиг.
*   `/perudoadmin npc create <name>` – Создаёт NPC.
*   `/perudoadmin npc remove` – Удаляет целевого NPC.
*   `/perudoadmin game cancel` – Отменяет игру у целевого NPC и **возвращает ставки** (вернуть предметы в инвентарь / вернуть деньги на счёт).

---

### **6. Технические требования**

*   **Версия Minecraft:** 1.16.5+ (Spigot/Paper).
*   **Обязательные зависимости:**
    *   **[Citizens API](https://ci.citizensnpcs.co/job/Citizens2/)** (для работы с NPC).
    *   **[Vault](https://www.spigotmc.org/resources/vault.34315/)** (для экономической составляющей).
*   **Рекомендуется:** Пакет ресурсов для красивого меню NPC.
